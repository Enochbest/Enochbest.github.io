<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Promise - Enoch&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Enoch&#039;s Blog"><meta name="msapplication-TileImage" content="/images/avator.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Enoch&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="promise是什么东西？官方解释 ：Promise是异步编程的一种解决方案，可以替代传统的解决方案–回调函数和事件。ES6统一了用法，并原生提供了Promise对象。作为对象，Promise有以下两个特点：  对象的状态不受外界影响。 一旦状态改变了就不会再变，也就是说任何时候Promise都只有一种状态。  我的解释：Promise 实际上就是作为一个容器，这个容器放着会在未来产生结果的"><meta property="og:type" content="blog"><meta property="og:title" content="Enoch&#039;s Blog"><meta property="og:url" content="http://example.com/2022/05/25/Promise/"><meta property="og:site_name" content="Enoch&#039;s Blog"><meta property="og:description" content="promise是什么东西？官方解释 ：Promise是异步编程的一种解决方案，可以替代传统的解决方案–回调函数和事件。ES6统一了用法，并原生提供了Promise对象。作为对象，Promise有以下两个特点：  对象的状态不受外界影响。 一旦状态改变了就不会再变，也就是说任何时候Promise都只有一种状态。  我的解释：Promise 实际上就是作为一个容器，这个容器放着会在未来产生结果的"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/40732470/1710555254972-e712be12-13a8-4893-bee7-d44d886e0131.png#averageHue=%23fbf6f5&amp;clientId=u97f398a0-8d5e-4&amp;from=paste&amp;height=96&amp;id=u31622d85&amp;originHeight=144&amp;originWidth=867&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=16583&amp;status=done&amp;style=none&amp;taskId=u4cf00c7f-027c-4c73-97dd-9e34abd43cc&amp;title=&amp;width=578"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/40732470/1710555285777-5c1a48ed-bc61-4ca4-afce-b4f199d040f0.png#averageHue=%23fcfbfa&amp;clientId=u97f398a0-8d5e-4&amp;from=paste&amp;height=131&amp;id=uffcaef26&amp;originHeight=197&amp;originWidth=733&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=13914&amp;status=done&amp;style=none&amp;taskId=u6afc546b-ec21-49cb-8c79-a70824c5ec2&amp;title=&amp;width=488.6666666666667"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/40732470/1710559603837-1988ab57-dc4a-493c-b81c-86e97536d89b.png#averageHue=%23fcfcfb&amp;clientId=u97f398a0-8d5e-4&amp;from=paste&amp;height=231&amp;id=ud6489b64&amp;originHeight=346&amp;originWidth=855&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=30321&amp;status=done&amp;style=none&amp;taskId=ubd3c2c12-0ce4-42f7-aa67-94d6e8b18a1&amp;title=&amp;width=570"><meta property="article:published_time" content="2022-05-25T03:25:34.000Z"><meta property="article:modified_time" content="2024-05-27T03:27:12.869Z"><meta property="article:author" content="Enoch"><meta property="article:tag" content="es6"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cdn.nlark.com/yuque/0/2024/png/40732470/1710555254972-e712be12-13a8-4893-bee7-d44d886e0131.png#averageHue=%23fbf6f5&amp;clientId=u97f398a0-8d5e-4&amp;from=paste&amp;height=96&amp;id=u31622d85&amp;originHeight=144&amp;originWidth=867&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=16583&amp;status=done&amp;style=none&amp;taskId=u4cf00c7f-027c-4c73-97dd-9e34abd43cc&amp;title=&amp;width=578"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"blog"},"headline":"Promise","image":[],"datePublished":"2022-05-25T03:25:34.000Z","dateModified":"2024-05-27T03:27:12.869Z","author":{"@type":"Person","name":"Enoch"},"publisher":{"@type":"Organization","name":"Enoch's Blog","logo":{"@type":"ImageObject","url":"/images/avator.jpg"}},"description":"promise是什么东西？官方解释 ：Promise是异步编程的一种解决方案，可以替代传统的解决方案–回调函数和事件。ES6统一了用法，并原生提供了Promise对象。作为对象，Promise有以下两个特点：  对象的状态不受外界影响。 一旦状态改变了就不会再变，也就是说任何时候Promise都只有一种状态。  我的解释：Promise 实际上就是作为一个容器，这个容器放着会在未来产生结果的"}</script><link rel="canonical" href="http://example.com/2022/05/25/Promise/"><link rel="icon" href="/images/avator.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/avator.jpg" alt="Enoch&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-05-25T03:25:34.000Z" title="2022/5/25 11:25:34">2022-05-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-05-27T03:27:12.869Z" title="2024/5/27 11:27:12">2024-05-27</time></span><span class="level-item"><a class="link-muted" href="/categories/js/">js</a></span><span class="level-item">30 minutes read (About 4525 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">Promise</h1><div class="content"><meta name="referrer" content="no-referrer">

<p><a name="Uezi0"></a></p>
<h2 id="promise是什么东西？"><a href="#promise是什么东西？" class="headerlink" title="promise是什么东西？"></a>promise是什么东西？</h2><p>官方解释 ：Promise是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B&spm=1001.2101.3001.7020">异步编程</a>的一种解决方案，可以替代传统的解决方案–回调函数和事件。ES6统一了用法，并原生提供了Promise对象。作为对象，Promise有以下两个特点：</p>
<ol>
<li>对象的状态不受外界影响。</li>
<li>一旦状态改变了就不会再变，也就是说任何时候Promise都只有一种状态。</li>
</ol>
<p>我的解释：Promise 实际上就是作为一个容器，这个容器放着会在未来产生结果的代码，未来的结果一旦产生Promise的状态就会被定下来，我们就可以根据这个状态或者未来代码执行的结果进行下一步的操作。<br><a name="rHIhk"></a></p>
<span id="more"></span>
<h2 id="Promise的三种状态"><a href="#Promise的三种状态" class="headerlink" title="Promise的三种状态"></a>Promise的三种状态</h2><p>Promise有三种状态，分别是 Pending (进行中)、Resolved (已完成)、Rejected (已失败)。注意Pending状态是从Promise对象被创建开始时就会开始执行其内部代码，所以从创建开始他就是pending状态，同时Priomise对象内部代码的执行机制时从创建就开始执行。Promise从Pending状态开始，如果成功就转到成功态，并执行resolve回调函数；如果失败就转到失败状态并执行reject回调函数。这个状态时不可逆的，下面看这个例子，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个Promise对象</span></span><br><span class="line"><span class="keyword">const</span> promiseExample = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> randomNumber = <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">  <span class="keyword">if</span> (randomNumber &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">    <span class="comment">// 模拟异步操作成功</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">&quot;Promise resolved successfully!&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 模拟异步操作失败</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Promise rejected!&quot;</span>));</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印Promise状态：进行中</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(promiseExample,<span class="string">&quot;Promise状态：进行中&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用.then()方法处理异步操作成功的情况</span></span><br><span class="line">promiseExample.<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 打印Promise状态：已成功</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(promiseExample,<span class="string">&quot;Promise状态：已成功&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;成功的结果：&quot;</span>, result);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 打印Promise状态：已失败</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(promiseExample,<span class="string">&quot;Promise状态：已失败&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;失败的原因：&quot;</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>我们看一下这个例子，用一个随机数模拟出从pending-fulfilled,pending-reject,我们看以下打印来验证以下promise装填变化过程中的代码执行顺序<br>失败的过程<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40732470/1710555254972-e712be12-13a8-4893-bee7-d44d886e0131.png#averageHue=%23fbf6f5&clientId=u97f398a0-8d5e-4&from=paste&height=96&id=u31622d85&originHeight=144&originWidth=867&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=16583&status=done&style=none&taskId=u4cf00c7f-027c-4c73-97dd-9e34abd43cc&title=&width=578" alt="image.png"><br>成功的过程<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40732470/1710555285777-5c1a48ed-bc61-4ca4-afce-b4f199d040f0.png#averageHue=%23fcfbfa&clientId=u97f398a0-8d5e-4&from=paste&height=131&id=uffcaef26&originHeight=197&originWidth=733&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=13914&status=done&style=none&taskId=u6afc546b-ec21-49cb-8c79-a70824c5ec2&title=&width=488.6666666666667" alt="image.png"><br><a name="VylTS"></a></p>
<h3 id="excutor-，-resolve-，reject"><a href="#excutor-，-resolve-，reject" class="headerlink" title="excutor ， resolve ，reject"></a>excutor ， resolve ，reject</h3><p>上面的例子涉及到三个PromiseApi<br>参数 executor 称为执行器，为一<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0&spm=1001.2101.3001.7020">回调函数</a> (resolve, reject) &#x3D;&gt; {}：<br>调用 resolve，Promise 实例的状态会从 pending 变为 fulfilled<br>如果不调用 resolve &#x2F; reject，则 Promise 实例的状态将一直是 pending。</p>
<p>调用 resolve &#x2F; reject 改变 Promise 实例状态时，可传入 1 个参数作为该 Promise 实例的值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&#x27;pro1Resolve&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro1&#x27;</span>, pro1); <span class="comment">// pro1 Promise &#123; &lt;fulfilled&gt;: &#x27;pro1Resolve&#x27; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pro2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> <span class="title function_">reject</span>(<span class="string">&#x27;pro2Reject&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro2&#x27;</span>, pro2); <span class="comment">// pro2 Promise &#123; &lt;rejected&gt;: &#x27;pro2Reject&#x27; &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>除了调用  resolve &#x2F; reject ，抛出错误也会改变 Promise 实例的状态。抛出错误，Promise 实例的状态从 pending 变为 rejected：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&#x27;errorMsg&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro3&#x27;</span>, pro3); <span class="comment">// pro3 Promise &#123; &lt;rejected&gt;: &#x27;errorMsg&#x27; &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>状态只能从 pending 变为 fulfilled &#x2F; rejected，且状态一旦更新就不会再改变：d</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(); <span class="comment">// resolve 写在前面，生效</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&#x27;error&#x27;</span>; <span class="comment">// 后面的 throw 无效</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro&#x27;</span>, pro); <span class="comment">// pro1 Promise &#123; &lt;fulfilled&gt;: undefined &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="kpfOc"></a></p>
<h2 id="then-catch-finally："><a href="#then-catch-finally：" class="headerlink" title="then &amp; catch &amp; finally："></a>then &amp; catch &amp; finally：</h2><p>上个例子中我们还涉及到Promise对象上的两个方法 then，catch，实际上还有很多，一一理解<br><a name="wHnGe"></a></p>
<h3 id="pro-then-onResolve-onReject"><a href="#pro-then-onResolve-onReject" class="headerlink" title="pro.then ( onResolve, onReject )"></a>pro.then ( onResolve, onReject )</h3><p>接收两个回调函数作为参数，</p>
<ol>
<li>回调函数 onResolve：处理状态为 fulfilled 的 Promise 实例。</li>
<li>回调函数 onReject：处理状态为 rejected 的 Promise 实例 (可选) 。</li>
</ol>
<p>onReject &amp; onResolve 都可以接收 1 个参数，参数值为调用该方法的 Promise 实例的值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pro1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;Fulfilled&#x27;</span>);</span><br><span class="line">pro1.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro1&#x27;</span>, value); <span class="comment">// pro1 Fulfilled</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pro2 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;Rejected&#x27;</span>);</span><br><span class="line">pro2.<span class="title function_">then</span>(<span class="literal">null</span>, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro2&#x27;</span>, reason); <span class="comment">// pro2 Rejected</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>像平时我们自己用的时候一般用的比较多的时第一个参数，去处理成功的（fulfilled）的Promise实例<br>我们也可以像上面那样去处理失败的Promise实例<br>onResolve &amp; onReject 会返回一个新的 Promise 实例，这是实际上就是为什么then可以进行链式调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pro = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;Fulfilled&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro&#x27;</span>, pro); <span class="comment">// proThen Promise &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> proThen = pro.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;value&#x27;</span>, value);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;proThen代码执行完了&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;proThen&#x27;</span>, proThen); <span class="comment">// proThen Promise &#123;&lt;pending&gt;&#125;</span></span><br><span class="line">proThen.<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res&#x27;</span>, res); <span class="comment">// value Fulfilled</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;proThen&#x27;</span>, proThen); <span class="comment">// proThen Promise &#123;&lt;fulfilled&gt;&#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>我们看一下两此打印 prothen对象的结果</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40732470/1710559603837-1988ab57-dc4a-493c-b81c-86e97536d89b.png#averageHue=%23fcfcfb&clientId=u97f398a0-8d5e-4&from=paste&height=231&id=ud6489b64&originHeight=346&originWidth=855&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=30321&status=done&style=none&taskId=ubd3c2c12-0ce4-42f7-aa67-94d6e8b18a1&title=&width=570" alt="image.png"></p>
<p>再让我们来看一个例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;pro&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> then1 = pro.<span class="title function_">then</span>(<span class="function"><span class="params">val1</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val1&#x27;</span>, val1); <span class="comment">// val1 pro</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;then1Resolve&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;then1&#x27;</span>, then1); <span class="comment">// then1 Promise &#123;&lt;fulfilled&gt;: &#x27;then1Resolve&#x27;&#125;</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> then2 = pro.<span class="title function_">then</span>(<span class="function"><span class="params">val2</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val2&#x27;</span>, val2); <span class="comment">// val2 pro</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;then2Reject&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;then2&#x27;</span>, then2); <span class="comment">// then2 Promise &#123;&lt;rejected&gt;: &#x27;then2Reject&#x27;&#125;</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上例的输出顺序为：<br>val1 pro - val2 pro - then1 Promise {<fulfilled>: ‘then1Resolve’} - then2 Promise {<rejected>: ‘then2Reject’}<br>（这里是和js的事件循环机制息息相关的，这个例子中pro.then属于微任务，setTimeout是宏任务，都是异步任务，宏任务和微任务的执行顺序：总方针是先同步再异步，异步中先微任务，在宏任务）</rejected></fulfilled></p>
<p>如果 return 的数据不是 Promise 实例，会自动创建 fulfilled 状态的 Promise 实例，并将 return 的数据设置为 Promise 实例的值<br>如果没有 return 语句，则该 Promise 实例的值为 undefined：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;proFulfilled&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> then1 = pro.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;value&#x27;</span>, value); <span class="comment">// value proFulfilled</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;superman&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;then1&#x27;</span>, then1); <span class="comment">// then1 Promise &#123;&lt;rejected&gt;: &#x27;superman&#x27;&#125;</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> then2 = pro.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;value&#x27;</span>, value); <span class="comment">// value proFulfilled</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;then2&#x27;</span>, then2); <span class="comment">// then2 Promise &#123;&lt;fulfilled&gt;: undefined&#125;</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">QuickSort</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Sort</span> &#123;</span><br><span class="line">  <span class="title function_">sort</span>(<span class="params">originalArray</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> array = [...originalArray];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (array.<span class="property">length</span> &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Init left and right arrays.</span></span><br><span class="line">    <span class="keyword">const</span> leftArray = [];</span><br><span class="line">    <span class="keyword">const</span> rightArray = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Take the first element of array as a pivot.</span></span><br><span class="line">    <span class="keyword">const</span> pivotElement = array.<span class="title function_">shift</span>();</span><br><span class="line">    <span class="keyword">const</span> centerArray = [pivotElement];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Split all array elements between left, center and right arrays.</span></span><br><span class="line">    <span class="keyword">while</span> (array.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> currentElement = array.<span class="title function_">shift</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Call visiting callback.</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="title function_">visitingCallback</span>(currentElement);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">comparator</span>.<span class="title function_">equal</span>(currentElement, pivotElement)) &#123;</span><br><span class="line">        centerArray.<span class="title function_">push</span>(currentElement);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">comparator</span>.<span class="title function_">lessThan</span>(currentElement, pivotElement)) &#123;</span><br><span class="line">        leftArray.<span class="title function_">push</span>(currentElement);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        rightArray.<span class="title function_">push</span>(currentElement);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Sort left and right arrays.</span></span><br><span class="line">    <span class="keyword">const</span> leftArraySorted = <span class="variable language_">this</span>.<span class="title function_">sort</span>(leftArray);</span><br><span class="line">    <span class="keyword">const</span> rightArraySorted = <span class="variable language_">this</span>.<span class="title function_">sort</span>(rightArray);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> leftArraySorted.<span class="title function_">concat</span>(centerArray, rightArraySorted);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="H1Yc8"></a></p>
<h3 id="pro-catch-onReject"><a href="#pro-catch-onReject" class="headerlink" title="pro.catch ( onReject )"></a>pro.catch ( onReject )</h3><p>catch(onReject) 是 then(null, onRejected) 的语法糖：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> <span class="title function_">reject</span>(<span class="string">&#x27;error&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proCatch = pro.<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason); <span class="comment">// reason error</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;proCatch&#x27;</span>, proCatch); <span class="comment">// proCatch Promise &#123;&lt;fulfilled&gt;: undefined&#125;</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p><a name="XcyBK"></a></p>
<h3 id="pro-finally-callback"><a href="#pro-finally-callback" class="headerlink" title="pro.finally ( callback )"></a>pro.finally ( callback )</h3><ul>
<li>状态为 fulfilled 和 rejected 的 Promise 实例都会被 finally 的回调函数处理</li>
<li>但是 pending 状态的 Promise 实例<strong>不</strong>会被 finally 的回调函数处理</li>
<li>finally 的回调函数不接收参数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">pro1.<span class="title function_">finally</span>(<span class="function"><span class="params">_</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro1 resolve&#x27;</span>)); <span class="comment">// pro1 resolve</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pro2 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>();</span><br><span class="line">pro2.<span class="title function_">finally</span>(<span class="function"><span class="params">_</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro2 reject&#x27;</span>)); <span class="comment">// pro2 reject</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pro3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">pro3.<span class="title function_">finally</span>(<span class="function"><span class="params">_</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro3 pending&#x27;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>finally 方法默认返回<strong>新的</strong> Promise 实例，新的 Promise 实例的 [状态] 和 [值] 与调用 finally 的 Promise 实例一致</li>
<li>即使显式重写了新的 return 语句，该 return 语句也不会生效</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;pro&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro&#x27;</span>, pro); <span class="comment">// pro Promise &#123;&lt;fulfilled&gt;: &#x27;pro&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fin = pro.<span class="title function_">finally</span>(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;finally&#x27;</span>); <span class="comment">// finally</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;finally&#x27;</span>); <span class="comment">// return 语句无效</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;fin&#x27;</span>, fin); <span class="comment">// fin Promise &#123;&lt;fulfilled&gt;: &#x27;pro&#x27;&#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(fin === pro); <span class="comment">// false</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="Q1oi6"></a></p>
<h2 id="重要必掌握知识点"><a href="#重要必掌握知识点" class="headerlink" title="重要必掌握知识点"></a>重要必掌握知识点</h2><p><a name="otZcw"></a></p>
<h3 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h3><ul>
<li>因为 then &#x2F; catch &#x2F; finally 返回的还是一个 Promise 实例，所以可以链式调用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;first&#x27;</span>);</span><br><span class="line"></span><br><span class="line">pro.<span class="title function_">then</span>(<span class="function"><span class="params">val1</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val1&#x27;</span>, val1); <span class="comment">// val1 first</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;second&#x27;</span>;</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">val2</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val2&#x27;</span>, val2)) <span class="comment">// val2 second</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">val3</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val3&#x27;</span>, val3)); <span class="comment">// val3 undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上例中，第 1 个 then 返回了 “second”，所以 val2 为 second；第 2 个 then 没有返回值，所以 val3 为 undefined</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;first&#x27;</span>);</span><br><span class="line"></span><br><span class="line">pro.<span class="title function_">then</span>(<span class="function"><span class="params">val1</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val1&#x27;</span>, val1);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;second&#x27;</span>;</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason)) <span class="comment">// reason first</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">val2</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val2&#x27;</span>, val2)); <span class="comment">// val2 undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上例中，因为 pro 的状态是 rejected，所以跳过第一个 then 方法，直接到 catch 方法执行；<br>因为 catch 方法没有 return 语句，所以 val2 为 undefined</p>
<ul>
<li>在链式调用中，没有按照规则传入回调函数的 then、catch、finally 方法，都会被直接跳过：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;p1&#x27;</span>);</span><br><span class="line"></span><br><span class="line">p1.<span class="title function_">then</span>(<span class="function"><span class="params">res1</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res1&#x27;</span>, res1)) <span class="comment">// res1 p1</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res2</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res2&#x27;</span>, res2); <span class="comment">// res2 undefined</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;string&#x27;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="string">&#x27;我是字符串&#x27;</span>) <span class="comment">// 这里有两个没写回调函数的 then 方法, 会被直接跳过</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res3</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res3&#x27;</span>, res3)); <span class="comment">// res3 string  ——  这里 res3 接收的是前面的合法返回值</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="WJDuH"></a></p>
<h3 id="Promise-异常穿透"><a href="#Promise-异常穿透" class="headerlink" title="Promise 异常穿透"></a><strong>Promise 异常穿透</strong></h3><p>使用 Promise 的链式调用时，可以在最后设置 catch 方法，并指定失败的回调函数<br>这样，前面任何操作出现异常，都会传到最后的 catch 中，执行其回调函数，这是我们写业务代码最常用的操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;pro&#x27;</span>);</span><br><span class="line"></span><br><span class="line">pro.<span class="title function_">then</span>(<span class="function"><span class="params">val1</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val1&#x27;</span>, val1); <span class="comment">// val1 pro</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;reject&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">val2</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val2&#x27;</span>, val2);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;then2&#x27; return&quot;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason)); <span class="comment">// reason reject</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上例中，因为第一个 then 方法返回的是 rejected 状态的 Promise 实例，所以不会走后面的 then 方法<br>这样，就直接跳到了最后的 catch 方法中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line"></span><br><span class="line">pro.<span class="title function_">then</span>(<span class="function"><span class="params">val1</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val1&#x27;</span>, val1); <span class="comment">// val1 ok</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">val2</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val2&#x27;</span>, val2))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason)); <span class="comment">// reason error</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上例中，因为第 1 个 then 方法抛出了错误，所以不会执行第二个 then 方法，直接跳到了最后的 catch 方法<br><a name="d7PT1"></a></p>
<h3 id="中断-Promise-链"><a href="#中断-Promise-链" class="headerlink" title="中断 Promise 链"></a><strong>中断 Promise 链</strong></h3><ul>
<li>中断 Promise 链，就是说在使用 then 的链式调用时，在中间断开，不再执行后面的回调函数</li>
<li>办法：在回调函数中，返回一个 pendding 状态的 Promise 对象(巧妙)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line"></span><br><span class="line">pro.<span class="title function_">then</span>(<span class="function"><span class="params">val1</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val1&#x27;</span>, val1); <span class="comment">// val1 ok</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">val2</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val2&#x27;</span>, val2))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述代码中，因为第 1 个 then 返回 pendding 状态的 Promise 对象，所以 Promise 链没有继续往下执行<br><a name="tfoSR"></a></p>
<h2 id="resolve-reject"><a href="#resolve-reject" class="headerlink" title="resolve &amp; reject"></a>resolve &amp; reject</h2><p><a name="ggCAx"></a></p>
<h3 id="Promise-resolve-value"><a href="#Promise-resolve-value" class="headerlink" title="Promise.resolve ( value )"></a>Promise.resolve ( value )</h3><ul>
<li>Promise构造函数上的静态方法，用于创建 fulfilled 状态的 Promise 实例</li>
<li>参数 value 为 Promise 实例的值；不传参数的话， Promise 实例的值为 undefiend</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">123</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro1&#x27;</span>, pro1); <span class="comment">// pro1 Promise &#123;&lt;fulfilled&gt;: 123&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pro2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro2&#x27;</span>, pro2); <span class="comment">// pro2 Promise &#123;&lt;fulfilled&gt;: undefined&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>如果参数 value 是 Promise 实例，则直接返回该实例</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&#x27;resolve&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> pro2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(pro1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pro2); <span class="comment">// Promise &#123;&lt;fulfilled&gt;: &#x27;resolve&#x27;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pro1 === pro2); <span class="comment">// true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="zcnp6"></a></p>
<h3 id="Promise-reject-reason"><a href="#Promise-reject-reason" class="headerlink" title="Promise.reject ( reason )"></a>Promise.reject ( reason )</h3><ul>
<li>用于创建 rejected 状态的 Promise 实例</li>
<li>参数 reason 为 Promise 实例的值；不传参的话，Promise 实例的值为 undefiend</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;reason&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro1&#x27;</span>, pro1); <span class="comment">// pro1 Promise &#123;&lt;rejected&gt;: &#x27;reason&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pro2 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro2&#x27;</span>, pro2); <span class="comment">// pro2 Promise &#123;&lt;rejected&gt;: undefined&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>与 Promise.resolve(value) 不同的是：即使参数 reason 是 Promise 实例，也会成为新创建的 Promise 实例的值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&#x27;pro&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> pro2 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(pro1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pro2&#x27;</span>, pro2); <span class="comment">// pro2 Promise &#123;&lt;rejected&gt;: Promise&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="BGiSC"></a></p>
<h2 id="all-race-allSettled-any"><a href="#all-race-allSettled-any" class="headerlink" title="all &amp; race &amp; allSettled &amp; any"></a>all &amp; race &amp; allSettled &amp; any</h2><p><a name="wik4x"></a></p>
<h3 id="Promise-all-promiseArr"><a href="#Promise-all-promiseArr" class="headerlink" title="Promise.all ( promiseArr )"></a>Promise.all ( promiseArr )</h3><ul>
<li>Promise.all(promiseArr) 接收一个 Promise 对象数组作为参数</li>
<li>该方法返回一个新的 Promise 对象</li>
</ul>
<p>当所有的 Promise 都 fulfilled 后，按照传入的 Promise 数组的顺序 将每个 Promise 对象的 resolve 值存储在一个新的数组中，并将该数组作为 Promise.all 方法返回的 Promise 对象的 resolve 值结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;resolve p1&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">500</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;resolve p2&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;resolve p3&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">1500</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p3, p2]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res&#x27;</span>, res); <span class="comment">// res [&#x27;resolve p1&#x27;, &#x27;resolve p2&#x27;, &#x27;resolve p3&#x27;]  ( 1.5s 后输出 )</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>只要有一个 Promise 被 rejected，就会立即返回一个 rejected 的 Promise 对象(巧妙)，其中包含第一个被 rejected 的 Promise 对象的错误信息(有点像数组的some方法)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;resolve p1&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="string">&#x27;reject p2&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="string">&#x27;reject p3&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">10000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p3, p2]).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;err&#x27;</span>, err); <span class="comment">// err reject p2  ( 2s 后输出 )</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="fXaqg"></a></p>
<h3 id="Promise-any-promiseArr"><a href="#Promise-any-promiseArr" class="headerlink" title="Promise.any ( promiseArr )"></a>Promise.any ( promiseArr )</h3><ul>
<li>Promise.any(promiseArr) 接收一个 Promise 对象数组作为参数</li>
<li>该方法返回一个新的 Promise 对象</li>
</ul>
<p>如果传入的 Promise 数组中至少有一个 Promise 对象变为 resolve 状态，则 Promise.any 的返回值会变成一个 Fulfill 状态的 Promise 对象，并且这个对象的值会等于最先变为 resolve 状态的 Promise 对象的 resolve 值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;reject p1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&#x27;resolve p2&#x27;</span>), <span class="number">1000</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;resolve p3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">any</span>([p1, p2, p3])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value)) <span class="comment">// resolve p3</span></span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果传入的 Promise 数组中所有的 Promise 对象都变为 reject 状态，则 Promise.any 的返回值会变成一个 Reject 状态的 Promise 对象，并抛出一个 AggregateError 错误，其中包含了所有 reject 的原因信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;reject p1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="string">&#x27;reject p2&#x27;</span>), <span class="number">1000</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;reject p3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">any</span>([p1, p2, p3])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error)); <span class="comment">// AggregateError: All promises were rejected</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="VBGcP"></a></p>
<h3 id="Promise-allSettled-promiseArr"><a href="#Promise-allSettled-promiseArr" class="headerlink" title="Promise.allSettled ( promiseArr )"></a>Promise.allSettled ( promiseArr )</h3><ul>
<li>Promise.all(promiseArr) 接收一个 Promise 对象数组作为参数</li>
<li>在所有 Promise 对象都 settle 后返回一个新的 Promise 对象，该对象的 Fulfill 状态的值是一个数组，包含每个 Promise 对象的 settle 状态信息（即不管 resolve 还是 reject 都会被处理）</li>
<li>注意：若有错误抛出，则抛出错误信息，并终止函数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;resolve p1&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="string">&#x27;reject p2&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="string">&#x27;reject p3&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pas = <span class="title class_">Promise</span>.<span class="title function_">allSettled</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="function"><span class="params">valArr</span> =&gt;</span> &#123;</span><br><span class="line">    valArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`item <span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>: `</span>, item);</span><br><span class="line">        <span class="comment">// item 1:  &#123;status: &#x27;fulfilled&#x27;, value: &#x27;resolve p1&#x27;&#125;</span></span><br><span class="line">        <span class="comment">// item 2:  &#123;status: &#x27;rejected&#x27;, reason: &#x27;reject p2&#x27;&#125;</span></span><br><span class="line">        <span class="comment">// item 3:  &#123;status: &#x27;rejected&#x27;, reason: &#x27;reject p3&#x27;&#125;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="qR5T1"></a></p>
<h3 id="Promise-race-promiseArr"><a href="#Promise-race-promiseArr" class="headerlink" title="Promise.race ( promiseArr )"></a>Promise.race ( promiseArr )</h3><ul>
<li>Promise.race(promiseArr) 接收一个 Promise 对象数组作为参数</li>
<li>该方法返回一个新的 Promise 对象，在 promiseArr 包含的 Promise 对象中有一个对象 settled ( 已解决，即已经 fulfilled &#x2F; rejected ) 时立即 resolve &#x2F; reject</li>
<li>注意：抛出异常的 Promise 实例不会被 Promise.race 处理</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;resolve p1&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="string">&#x27;reject p2&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">&#x27;error p3&#x27;</span>; <span class="comment">// 抛出异常, 不会被处理</span></span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([p1, p2, p3])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;value&#x27;</span>, value)) <span class="comment">// value resolve p1</span></span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以使用 Promise.race 来实现一个超时控制，如果某个异步操作在指定时间内没有完成，就抛出超时异常：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">timeoutPromise</span>(<span class="params">promise, timeout</span>) &#123;</span><br><span class="line">    <span class="comment">// 返回一个新的 Promise 对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>([</span><br><span class="line">        promise, <span class="comment">// 原始的 Promise 对象</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 将给定的时间转换为毫秒单位</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Operation timed out&#x27;</span>));</span><br><span class="line">            &#125;, timeout);</span><br><span class="line">        &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeout = <span class="number">5000</span>; <span class="comment">// 设置超时时间为 5 秒钟</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;Operation completed successfully&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 timeoutPromise 函数测试</span></span><br><span class="line"><span class="title function_">timeoutPromise</span>(promise, timeout)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">// 打印输出 &quot;Operation completed successfully&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(error); <span class="comment">// 打印输出 &quot;Error: Operation timed out&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上例中，setTimeout 函数模拟了一个需要等待 3 秒钟才能完成的异步操作。我们设置了超时时间为 5 秒钟，所以 Promise.race 方法会在 3 秒钟后返回原始的 Promise 对象的结果。如果在 5 秒钟内未完成该操作，则会抛出超时错误</p>
<p><a name="mLfcU"></a></p>
<h2 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async&#x2F;Await"></a><strong>Async&#x2F;Await</strong></h2><p>async和await是建立在Promise之上的高级抽象，使得异步代码的编写和阅读更加接近于同步代码的风格。<br><a name="n7oA0"></a></p>
<h3 id="Async-函数"><a href="#Async-函数" class="headerlink" title="Async 函数"></a>Async 函数</h3><p>通过在函数声明前加上async关键字，可以将任何函数转换为返回Promise的异步函数。这意味着你可以使用.then()和.catch()来处理它们的结果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">asyncFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;异步操作完成&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">asyncFunction</span>().<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value)); <span class="comment">// 输出：异步操作完成</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a name="rbJoW"></a></p>
<h3 id="Await关键字"><a href="#Await关键字" class="headerlink" title="Await关键字"></a>Await关键字</h3><p>await关键字只能在async函数内部使用。它可以暂停async函数的执行，等待Promise的解决（resolve），然后以Promise的值继续执行函数。(这里有一个和事件循环相关的知识点：await后面的表达式是同步执行的，await下面的代码会进入为任务队列等待执行)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">asyncFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;完成&quot;</span>), <span class="number">1000</span>)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">await</span> promise; <span class="comment">// 等待，直到promise解决 (resolve)</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">// &quot;完成&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">asyncFunction</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在实际应用中，async和await使得处理复杂的异步逻辑更加简单，尤其是在涉及多个依次执行的异步操作时。 前几年的版本时，浏览器执行过程中await 会阻塞后续代码，将后续的代码放入微任务队列中，但是现在的浏览器执行代码时会给紧跟在await关键字后的代码开小灶，相当于紧随在await关键字后的代码变成同步代码，但是再往后的代码依旧会被推入微任务队列。</p>
<p><a name="wam2Z"></a></p>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>在async&#x2F;await中，错误处理可以通过传统的try…catch语句实现，这使得异步代码的错误处理更加直观。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">asyncFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;http://example.com&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    <span class="comment">// 处理数据</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;捕获到错误：&#x27;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">asyncFunction</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>之前就遇到过一个很奇葩的业务场景，是属于数据库数据遗留问题，后端没对数据进行过数据清理，导致一些时JS字符串，在JSON转的时候会报错 就在catch里面去处理正确的逻辑</p>
<p><a name="Bcd36"></a></p>
<h2 id="Promise与Async-Await的比较"><a href="#Promise与Async-Await的比较" class="headerlink" title="Promise与Async&#x2F;Await的比较"></a><strong>Promise与Async&#x2F;Await的比较</strong></h2><p>虽然async&#x2F;await在很多情况下可以提供更清晰和简洁的代码，但Promise也有其独特的优势。例如，处理多个并行异步操作时，Promise.all()通常是更好的选择。选择使用Promise或async&#x2F;await通常取决于具体的应用场景和个人偏好。</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/es6/">es6</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/05/27/cookie-sessionStorage-LocalStorage/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">cookie sessionStorage LocalStorage</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/05/25/%E5%85%A8%E6%96%B9%E4%BD%8D%E7%90%86%E8%A7%A3React%E7%B1%BB%E5%BC%8F%E7%BB%84%E4%BB%B6%E6%96%B0%E6%97%A7%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"><span class="level-item">全方位理解React类式组件新旧生命周期</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/avator.jpg" alt="Enoch"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Enoch</p><p class="is-size-6 is-block">有形非易测，无源讵可量。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>chengdu-SiChuan</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">36</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">10</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Enochbest" target="_blank" rel="noopener">Follow</a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/Enochbest" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Git-hub</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="2658929241@qq.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">E-mail</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/es6/"><span class="tag">es6</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/js/"><span class="tag">js</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/three/"><span class="tag">three</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/uniapp/"><span class="tag">uniapp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vue/"><span class="tag">vue</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vue3/"><span class="tag">vue3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"><span class="tag">区块链</span><span class="tag">10</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#promise是什么东西？"><span class="level-left"><span class="level-item">1</span><span class="level-item">promise是什么东西？</span></span></a></li><li><a class="level is-mobile" href="#Promise的三种状态"><span class="level-left"><span class="level-item">2</span><span class="level-item">Promise的三种状态</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#excutor-，-resolve-，reject"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">excutor ， resolve ，reject</span></span></a></li></ul></li><li><a class="level is-mobile" href="#then-catch-finally："><span class="level-left"><span class="level-item">3</span><span class="level-item">then &amp; catch &amp; finally：</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#pro-then-onResolve-onReject"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">pro.then ( onResolve, onReject )</span></span></a></li><li><a class="level is-mobile" href="#pro-catch-onReject"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">pro.catch ( onReject )</span></span></a></li><li><a class="level is-mobile" href="#pro-finally-callback"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">pro.finally ( callback )</span></span></a></li></ul></li><li><a class="level is-mobile" href="#重要必掌握知识点"><span class="level-left"><span class="level-item">4</span><span class="level-item">重要必掌握知识点</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#链式调用"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">链式调用</span></span></a></li><li><a class="level is-mobile" href="#Promise-异常穿透"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">Promise 异常穿透</span></span></a></li><li><a class="level is-mobile" href="#中断-Promise-链"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">中断 Promise 链</span></span></a></li></ul></li><li><a class="level is-mobile" href="#resolve-reject"><span class="level-left"><span class="level-item">5</span><span class="level-item">resolve &amp; reject</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Promise-resolve-value"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">Promise.resolve ( value )</span></span></a></li><li><a class="level is-mobile" href="#Promise-reject-reason"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">Promise.reject ( reason )</span></span></a></li></ul></li><li><a class="level is-mobile" href="#all-race-allSettled-any"><span class="level-left"><span class="level-item">6</span><span class="level-item">all &amp; race &amp; allSettled &amp; any</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Promise-all-promiseArr"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">Promise.all ( promiseArr )</span></span></a></li><li><a class="level is-mobile" href="#Promise-any-promiseArr"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">Promise.any ( promiseArr )</span></span></a></li><li><a class="level is-mobile" href="#Promise-allSettled-promiseArr"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">Promise.allSettled ( promiseArr )</span></span></a></li><li><a class="level is-mobile" href="#Promise-race-promiseArr"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">Promise.race ( promiseArr )</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Async-Await"><span class="level-left"><span class="level-item">7</span><span class="level-item">Async/Await</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Async-函数"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">Async 函数</span></span></a></li><li><a class="level is-mobile" href="#Await关键字"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">Await关键字</span></span></a></li><li><a class="level is-mobile" href="#错误处理"><span class="level-left"><span class="level-item">7.3</span><span class="level-item">错误处理</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Promise与Async-Await的比较"><span class="level-left"><span class="level-item">8</span><span class="level-item">Promise与Async/Await的比较</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Flutter/"><span class="level-start"><span class="level-item">Flutter</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Three-js%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">Three.js学习</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/dart%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">dart学习</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/js/"><span class="level-start"><span class="level-item">js</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/react/"><span class="level-start"><span class="level-item">react</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/uniapp/"><span class="level-start"><span class="level-item">uniapp</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/vue/"><span class="level-start"><span class="level-item">vue</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/vue3/"><span class="level-start"><span class="level-item">vue3</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/"><span class="level-start"><span class="level-item">前端安全</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">区块链基础</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/"><span class="level-start"><span class="level-item">区块链系统实现</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">浏览器原理</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-14T06:27:20.000Z">2024-03-14</time></p><p class="title"><a href="/2024/03/14/vue3-ts-%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%9B%A0%E4%B8%BA%E8%B7%AF%E7%94%B1%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F%E4%B8%8D%E5%90%8C%E5%AF%BC%E8%87%B4%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E5%A4%B1%E6%95%88/">vue3 ts 项目中因为路由加载方式不同导致的热更新失效及解决办法</a></p><p class="categories"><a href="/categories/vue3/">vue3</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-26T05:52:35.000Z">2023-12-26</time></p><p class="title"><a href="/2023/12/26/%E5%88%9D%E8%AF%86%E7%9D%80%E8%89%B2%E5%99%A8-%E5%8C%85%E6%8B%AC%E7%9D%80%E8%89%B2%E5%99%A8%E4%BC%A0%E5%8F%82/">初识着色器(包括着色器传参)</a></p><p class="categories"><a href="/categories/Three-js%E5%AD%A6%E4%B9%A0/">Three.js学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-25T05:50:41.000Z">2023-12-25</time></p><p class="title"><a href="/2023/12/25/%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF%E5%8E%9F%E7%90%86/">渲染管线原理</a></p><p class="categories"><a href="/categories/Three-js%E5%AD%A6%E4%B9%A0/">Three.js学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-09-09T12:12:41.000Z">2023-09-09</time></p><p class="title"><a href="/2023/09/09/IM%E5%8F%91%E9%80%81%E8%A1%A8%E6%83%85%EF%BC%88%E5%9F%BA%E4%BA%8Equill%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%EF%BC%89/">IM发送表情（基于quill富文本编辑器）</a></p><p class="categories"><a href="/categories/vue/">vue</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-09-07T12:42:20.000Z">2023-09-07</time></p><p class="title"><a href="/2023/09/07/%E5%9C%A8Vue3%E4%B8%AD%E4%BD%BF%E7%94%A8quill%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/">在Vue3中使用quill富文本编辑器</a></p><p class="categories"><a href="/categories/vue/">vue</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">March 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">December 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">September 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">August 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">July 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">June 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">May 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">March 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">February 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">December 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">November 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">October 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">September 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">August 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">July 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">May 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">January 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/avator.jpg" alt="Enoch&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Enoch</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>